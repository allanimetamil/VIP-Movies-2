<!DOCTYPE html>
<html>
<head>
    <title>My Vote</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=NATS:wght@400&display=swap" />
</head>

<style>
    *{
        padding: 0%;
        margin: 0%;
        font-family: Lexend;
    }
    nav{
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        height: 100px;
        background-color: rgb(255, 255, 255);
        border: 1px solid wheat;
    }
    #title{ height:70px; }
    #logo{ height: 50px; padding: 25px; }
    #main{
        width: 80%;
        margin: 5%;
        padding: 5%;
        background-color: antiquewhite;
        border-radius: 10px;
    }
    h2{ text-align: center; }
    input{
        width: 90%;
        color: rgb(105, 101, 101);
        padding: 10px 0px;
        margin: 10px;
        border: 2px solid rgb(90, 87, 87);
        border-radius: 5px;
    }
    label{ padding: 10px; }
    #party{
        padding: 10px;
        margin: 10px;
        border: 2px solid rgb(90, 87, 87);
        border-radius: 5px;
    }
    button{
        padding: 10px;
        margin: 10px;
        border: 1px solid rgb(90, 87, 87);
        border-radius: 2px;
        color: black;
        background-color: rgb(196, 199, 201);
    }
    #resultImg{
        border: 1px solid rgba(0, 0, 0, 0.495);
        border-radius: 10px;
        width: 90%;
        margin: 10px;
    }
    #result{
        padding: 10px;
        margin: 10px;
        color: red;
    }
</style>

<body>

<nav>
    <img id="title" src="./Title.png"/>
    <img id="logo" src="./Government-Of-Tamil-Nadu-Logo-Vector.svg-.png" />
</nav>

<div id="main">

<h2>TamilNadu Voting Portal</h2>

<img id="resultImg" width="300px"><br>
<h3 id="result"></h3>

<label>Name:</label><br>
<input type="text" id="name"><br><br>

<label>Age:</label><br>
<input type="number" id="age"><br><br>

<label>Select Party:</label><br>
<select id="party">
    <option value="">--Choose Party--</option>
    <option value="TVK">TVK</option>
    <option value="DMK">DMK</option>
    <option value="ADMK">ADMK</option>
    <option value="NTK">NTK</option>
</select><br><br>

<button onclick="vote()">Submit Vote</button>

</div>

<!-- ‚úÖ Firebase + Vote Function Inside SAME module -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAUHjP9TZMyMptZX-sf0RLn12zLNH6b7Kg",
  authDomain: "login-360-f227f.firebaseapp.com",
  projectId: "login-360-f227f",
  storageBucket: "login-360-f227f.firebasestorage.app",
  messagingSenderId: "972687843252",
  appId: "1:972687843252:web:80e0946e74260cdc449ce1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.vote = async function() {

    let name = document.getElementById("name").value;
    let age = Number(document.getElementById("age").value);
    let party = document.getElementById("party").value;

    let resultText = document.getElementById("result");
    let resultImg = document.getElementById("resultImg");

    if (name === "" || party === "" || !age) {
        resultText.innerText = "Please fill all details! ‚ùå";
        resultImg.src = "";
        return;
    }

    if (age < 18) {
        resultText.innerText = name + " You are not eligible to vote! ‚ùå";
        resultImg.src = "";
        return;
    }

    if (party === "DMK") resultImg.src = "DMK.webp";
        else if (party === "ADMK") resultImg.src = "ADMK.webp";
        else if (party === "TVK") resultImg.src = "TVK.jpg";
        else if (party === "NTK") resultImg.src = "NTK.jpg";

        resultText.style.color = "green";
        resultText.innerText = "üòá Thank you " + name + " for voting to " + party +" ü•≥..." + " Vote Submitted Successfully ‚úÖ";

    try {

        await addDoc(collection(db, "votes"), {
            name: name,
            age: age,
            party: party,
            time: new Date()
        });

    } catch (error) {
        resultText.innerText = "Error: server problem!";
        console.error(error);
    }
};

</script>


</body>
</html>
